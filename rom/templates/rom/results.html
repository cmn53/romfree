{% extends 'rom/base.html' %}
{% block content %}

  <h2>Hotels</h2>
  <div id="map"></div>

  <script type="text/javascript">
    let hotelData = {{ hotel_geojson|safe|escape }};
    let routeData = {{ route_geojson|safe|escape }};
    let destinationData = {{ destination_geojson|safe|escape }};

    let map = L.map('map', { minZoom: 9, maxZoom: 15 }).setView({{ map_center }}, 11);

    L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}{r}.png',
      {
        attribution: '&copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
      }).addTo(map);


    L.geoJson(routeData, {
      style: function (feature) {
        return { color: '#00bfff'}
      }
    }).addTo(map);

    let destinationLayer = L.geoJson(destinationData, {
      pointToLayer: function(feature, latlng) {
          return L.circleMarker(latlng, {
            color: '#A9A9A9',
            weight: 1,
            fillColor: '#808080',
            fillOpacity: 1,
            radius: 3
          })
      }
    }).addTo(map);


    let hotelLayer = L.geoJSON(hotelData, {
      pointToLayer: function(feature, latlng) {
        return L.marker(latlng, {
            icon: L.icon.glyph({
            prefix: '',
            glyph: feature.properties.score
          })
        })
      },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<h4>'+feature.properties.name+'</h4>')
      }
    }).addTo(map);


    let boundingFeatures = L.featureGroup();
    L.geoJson(hotelData, {
      onEachFeature: function (feature, layer) {
        L.marker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]]).addTo(boundingFeatures);
      }
    });
    map.fitBounds(boundingFeatures.getBounds().pad(0.05));

  </script>

  <div class="pagination">
    <span class="step-links">
        {% if hotels.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ hotels.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ hotels.number }} of {{ hotels.paginator.num_pages }}.
        </span>

        {% if hotels.has_next %}
            <a href="?page={{ hotels.next_page_number }}">next</a>
            <a href="?page={{ hotels.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>

  <ul>
  {% for hotel in hotels %}
    <li>
      <a href="{% url 'rom:detail' hotel.hotel.id %}"}>
        <img src="http://photos.hotelbeds.com/giata/medium/{{ hotel.hotel.image_set.first }}" alt="hotel stock image"/>
        <div>{{ hotel.hotel.name }}</div>
        <div>Score: {{ hotel.total_qtr_score }}</div>
      </a>
    </li>
  {% endfor %}
  </ul>

{% endblock %}
